var swag=swag||{};{class h{constructor(a){if(this.layers=[],this.batchSize=19,this.epoch=0,this.learningRate=.01,void 0!==a){for(var b=0;b<a.length-1;b++){if(this.layers.push(a[b]),a[b].outSize()!=a[b+1].inSize())throw"Failure connecting "+a[b].constructor.name+" layer with "+a[b+1].constructor.name+","+a[b].constructor.name+" output size: "+a[b].outSize()+", "+a[b+1].constructor.name+" input size: "+a[b+1].inSize();a[b+1].inData=a[b].outData,a[b].nextLayer=a[b+1]}this.layers.push(a[a.length-1])}}forward(a){if(!Array.isArray(a)){if("number"==typeof a)a=[a];else throw"INPUT ARRAYS INTO FORWARDS FUNCTION ONLY!"}this.layers[0].forward(a);for(var b=1;b<this.layers.length;b++)this.layers[b].forward();return new Float32Array(this.layers[this.layers.length-1].outData)}enableGPU(){for(var a=0;a<this.layers.length;a++)this.layers[a].gpuEnabled=!0,this.layers[a].initGPU&&this.layers[a].initGPU()}mutate(b,c){for(var a=0;a<this.layers.length;a++)this.layers[a].mutate&&this.layers[a].mutate(b,c)}disableGPU(){for(var a=0;a<this.layers.length;a++)this.layers[a].gpuEnabled=!1}save(b,c){if(b){if(swag.isBrowser()){var a=document.createElement("a"),d=new Blob([JSON.stringify(this.layers)]);a.href=URL.createObjectURL(d),a.download="model.json",a.click()}else require("fs").writeFileSync(c,JSON.stringify(this.layers))}return JSON.stringify(this.layers)}load(a){}copy(a){}train(d,c){this.forward(d);let b=0;for(var a=0;a<this.layers[this.layers.length-1].outData.length;a++)b+=Math.pow(c[a]-this.layers[this.layers.length-1].outData[a],2);b/=this.layers[this.layers.length-1].outData.length,this.layers[this.layers.length-1].backward(c);for(var a=this.layers.length-2;a>=0;a--)this.layers[a].backward();if(this.epoch++,this.epoch%this.batchSize==0)for(var a=this.layers.length-1;a>=0;a--)this.layers[a].updateParams&&this.layers[a].updateParams(this.learningRate);return b}}swag.Net=h}var swag=swag||{};{class i{constructor(e,c,f,g,h){this.networks=[],this.popSize=c,this.highScore=0,this.mutationRate=g||.3,this.mutationIntensity=h||.6,this.elitism=f;let a=new swag.Net(e);a.score=0;for(let d=0;d<c-1;d++){let b=new swag.Net;b.copy(a),b.score=0,this.networks.push(b)}this.networks.push(a)}cullAndBreed(){this.networks.sort((a,b)=>a.score>b.score?-1:1),this.highScore=this.networks[0].score<this.highScore?this.highScore:this.networks[0].score;let d=[];for(let b=0;b<this.elitism;b++)this.networks[b].score=0,d.push(this.networks[b]);for(let e=0;e<this.popSize-this.elitism;e++)for(let a=0;a<this.popSize;a++){if(.3>Math.random()){let c=new swag.Net;c.score=0,c.copy(this.networks[e]),c.mutate(.6,this.mutationRate),d.push(c),a=this.popSize+5}a==this.popSize-1&&(a=0)}this.networks=d}}swag.Population=i}var swag=swag||{};{var j=new Function("try {return this===window;}catch(e){ return false;}");let k=function(a,b,c){return Math.max(Math.min(a,c|=1),b|=0)},l=function(a){return a},m=function(a,b){if(Math.abs(a)>(b|=3)){var c=b*a/Math.abs(a);return m(a=c-(a-c),b)}return a},n=function(b,d){for(var c=0,a=0;a<b.length;a++)c+=Math.pow(b[a]-d[a],2);return c/b.length},o=function(f,d,i,j,a){let g=1;for(var c=0;c<f.layers.length;c++)"ConvLayer"!=f.layers[c].constructor.name&&"MaxPoolLayer"!=f.layers[c].constructor.name&&(f.layers[c].inSize()>g&&(g=f.layers[c].inSize()),f.layers[c].outSize()>g&&(g=f.layers[c].outSize())),d.fillStyle="grey",d.fillRect(i,j,5+f.layers.length*a*10+a,5+g*a*2);for(c=0;c<f.layers.length;c++){let b=f.layers[c];if("ConvLayer"!=b.constructor.name&&"MaxPoolLayer"!=b.constructor.name){for(var h=0;h<b.outSize();h++)d.fillStyle="rgb("+255*b.outData[e]+","+255*b.outData[e]+","+255*b.outData[e]+")",d.fillRect(i+5+(c+1)*a*10,j+5+h*a*2+(g*a*2/2-b.outSize()*a*2/2),a,a);for(var e=0;e<b.inSize();e++)d.fillStyle="rgb("+255*b.inData[e]+","+255*b.inData[e]+","+255*b.inData[e]+")",d.fillRect(i+5+c*a*10,j+5+e*a*2+(g*a*2/2-b.inSize()*a*2/2),a,a)}if("FCLayer"==b.constructor.name)for(var e=0;e<b.inSize();e++)for(var h=0;h<b.outSize();h++)d.strokeStyle="rgb("+ -(255*b.w[e*b.outSize()+h])+","+255*b.w[e*b.outSize()+h]+",0)",d.beginPath(),d.moveTo(i+5+c*a*10+a/2,a/2+j+5+e*a*2+(g*a*2/2-b.inSize()*a*2/2)),d.lineTo(i+5+(c+1)*a*10+a/2,a/2+j+5+h*a*2+(g*a*2/2-b.outSize()*a*2/2)),d.stroke();("SigmoidLayer"==b.constructor.name||"SineLayer"==b.constructor.name||"TanhLayer"==b.constructor.name)&&(d.fillStyle="white",d.font=a+"px serif",d.fillText(b.constructor.name.slice(0,-5),i+5+(c+.4)*a*10,j+5+b.inSize()/2*a*2+(g*a*2/2-b.inSize()*a*2/2))),b.constructor.name="ConvLayer"}};if(swag.clamp=k,swag.render=o,swag.getLoss=n,swag.tanh=Math.tanh,swag.lin=l,swag.bounce=m,swag.isBrowser=j,window.GPU){let p=new GPU;swag.gpu=p}swag.isBrowser()||("undefined"==typeof module|| void 0===module.exports?window.swag=swag:module.exports=swag)}{class d{constructor(c,d,e,f,g,h=3,i=1,b=0){if(0!=b)throw"Dear user, I have not implemented padding yet.. set it to zero to avoid this message. Star the project if you want me to complete it. or send me 5 bucks ill do it right now.";if(this.filters=h,this.inWidth=c,this.inHeight=d,this.inDepth=e,this.filterWidth=f,this.filterHeight=g,this.stride=i,this.padding=b,this.filterw=new Float32Array(h*e*f*g),this.filterws=new Float32Array(h*e*f*g),this.trainIterations=0,this.outData=new Float32Array(Math.ceil((c-f+2*b+1)/i)*Math.ceil((d-g+2*b+1)/i)*this.filters),this.inData=new Float32Array(c*d*e),this.costs=new Float32Array(c*d*e),this.b=new Float32Array(this.outData.length),this.bs=new Float32Array(this.outData.length),this.accessed=new Float32Array(this.inData.length).fill(1),this.filterWidth>c+b||this.filterHeight>d+b)throw"Conv layer error: filters cannot be bigger than the input";for(var a=0;a<this.filterw.length;a++)this.filterw[a]=1*Math.random()*(Math.random()>.5?-1:1);for(var a=9;a<18;a++)this.filterw[a]=1*Math.random()*(Math.random()>.5?-1:1);for(var a=0;a<this.b.length;a++)this.b[a]=1*Math.random()*(Math.random()>.5?-1:1);this.hMFHPO=Math.ceil((this.inHeight-this.filterHeight+1)/this.stride),this.wMFWPO=Math.ceil((this.inWidth-this.filterWidth+1)/this.stride),this.hMFWMF=this.hMFHPO*this.wMFWPO,this.wIH=this.inWidth*this.inHeight,this.wIHID=this.inWidth*this.inHeight*this.inDepth,this.fWIH=this.filterWidth*this.filterHeight,this.fWIHID=this.inDepth*this.filterHeight*this.filterWidth}inSize(){return this.inData.length}outSize(){return this.outData.length}inSizeDimensions(){return[this.inWidth,this.inHeight,this.inDepth]}outSizeDimensions(){return[Math.ceil((this.inWidth-this.filterWidth+2*this.padding+1)/this.stride),Math.ceil((this.inHeight-this.filterHeight+2*this.padding+1)/this.stride),this.filters]}forward(b){if(b){if(b.length!=this.inSize())throw"INPUT SIZE WRONG ON CONV LAYER:\nexpected array size ("+this.inSize()+", dimensions: ["+this.inSizeDimensions()+"]), got: ("+b.length+")";for(var a=0;a<b.length;a++)this.inData[a]=b[a]}this.outData.fill(0);for(var a=0;a<this.filters;a++){let i=a*this.hMFWMF,j=a*this.fWIHID;for(var c=0;c<this.hMFHPO;c++){let k=c*this.stride,l=c*this.wMFWPO;for(var d=0;d<this.wMFWPO;d++){let h=d+l+i,m=d*this.stride;for(var e=0;e<this.inDepth;e++){let n=e*this.wIH+m,o=e*this.fWIH+j;for(var f=0;f<this.filterHeight;f++){let p=(f+k)*this.inWidth+n,q=f*this.filterWidth+o;for(var g=0;g<this.filterWidth;g++)this.outData[h]+=this.inData[g+p]*this.filterw[g+q]}}this.outData[h]+=this.b[h]}}}}backward(h){this.trainIterations++;for(var a=0;a<this.inSize();a++)this.costs[a]=0;if(!h&& void 0==this.nextLayer)throw"error backproping on an unconnected layer with no expected parameter input";for(var a=0;a<this.filters;a++){let l=a*this.hMFWMF,m=a*this.fWIHID;for(var c=0;c<this.hMFHPO;c++){let n=c*this.stride,o=c*this.wMFWPO;for(var d=0;d<this.wMFWPO;d++){let e=d+o+l,p=d*this.stride,i=h?h[e]-this.outData[e]:this.nextLayer.costs[e];for(var f=0;f<this.inDepth;f++){let q=f*this.wIH,r=f*this.fWIH+m;for(var g=0;g<this.filterHeight;g++){let j=(g+n)*this.inWidth+q+p,k=g*this.filterWidth+r;for(var b=0;b<this.filterWidth;b++)this.costs[b+j]+=this.filterw[b+k]*i,this.accessed[b+j]++,this.filterws[b+k]+=this.inData[b+j]*i}}this.bs[e]+=i}}}for(var a=0;a<this.inSize();a++)this.costs[a]=this.costs[a]/this.accessed[a],this.accessed[a]=1}updateParams(b){for(var a=0;a<this.filterw.length;a++)this.filterws[a]/=this.outSize()/this.filters,this.filterw[a]+=this.filterws[a]*b,this.trainIterations=0}}swag.ConvLayer=d,swag.Conv=d}{class e{constructor(c,a){if(!c)throw"Missing parameter in FC Constructor: (input size)";if(!a)throw"Missing parameter in FC Constructor: (output size)";this.gpuEnabled=!1,this.trainIterations=0,this.ws=new Float32Array(c*a),this.bs=new Float32Array(a),this.nextLayer,this.inData=new Float32Array(c),this.outData=new Float32Array(a),this.w=new Float32Array(c*a),this.b=new Float32Array(a),this.costs=new Float32Array(c);for(var b=0;b<c;b++)for(var d=0;d<a;d++)this.w[d+b*a]=1*Math.random()*(Math.random()>.5?-1:1),this.ws[d+b*a]=0;for(var b=0;b<a;b++)this.b[b]=1*Math.random()*(Math.random()>.5?-1:1),this.bs[b]=0}forward(b){if(b){if(b.length!=this.inSize())throw"INPUT SIZE WRONG ON FC LAYER:\nexpected size ("+this.inSize()+"), got: ("+b.length+")";for(var c=0;c<b.length;c++)this.inData[c]=b[c]}for(var a=0;a<this.outSize();a++){this.outData[a]=0;for(var d=0;d<this.inSize();d++)this.outData[a]+=this.inData[d]*this.w[a+d*this.outSize()];this.outData[a]+=this.b[a]}}backward(e){this.trainIterations++;for(var a=0;a<this.inSize();a++)this.costs[a]=0;if(e)for(var b=0;b<this.outSize();b++){let c=e[b]-this.outData[b];for(var a=0;a<this.inSize();a++)this.ws[b+a*this.outSize()]+=this.inData[a]*c*2,this.costs[a]+=this.w[b+a*this.outSize()]*c*2;this.bs[b]+=c}else{if(void 0==this.nextLayer)throw"error backproping on an unconnected layer with no expected parameter input";for(var b=0;b<this.outSize();b++){let d=this.nextLayer.costs[b];for(var a=0;a<this.inSize();a++)this.ws[b+a*this.outSize()]+=this.inData[a]*d*2,this.costs[a]+=this.w[b+a*this.outSize()]*d*2;this.bs[b]+=d}}for(var a=0;a<this.inSize();a++)this.costs[a]=this.costs[a]/(this.inSize()*this.outSize())}inSize(){return this.inData.length}outSize(){return this.outData.length}updateParams(c){for(var a=0;a<this.outSize();a++)for(var b=0;b<this.inSize();b++)this.ws[a+b*this.outSize()]/=this.trainIterations,this.w[a+b*this.outSize()]+=this.ws[a+b*this.outSize()]*c,this.ws[a+b*this.outSize()]=0;for(var a=0;a<this.outSize();a++)this.bs[a]/=this.trainIterations,this.b[a]+=this.bs[a]*c,this.bs[a]=0;this.trainIterations=0}mutate(b,c){for(var a=0;a<this.w.length;a++)Math.random()<b&&(this.w[a]+=Math.random()*c*(Math.random()>.5?-1:1));for(var a=0;a<this.b.length;a++)Math.random()<b&&(this.b[a]+=Math.random()*c*(Math.random()>.5?-1:1))}}swag.FCLayer=e,swag.FC=e}{class a{constructor(a){this.nextLayer,this.inData=new Float64Array(a),this.outData=new Float64Array(a),this.costs=new Float64Array(a)}forward(a){if(a){if(a.length!=this.inSize())throw"INPUT SIZE WRONG ON (Input or output or linear) LAYER:\nexpected size ("+this.inSize()+"), got: ("+a.length+")";for(var b=0;b<a.length;b++)this.inData[b]=a[b]}for(var c=0;c<this.outSize();c++)this.outData[c]=this.inData[c]}backward(c){if(c)for(var a=0;a<this.outData.length;a++){let d=c[a]-this.outData[a];this.costs[a]=d}else{if(void 0==this.nextLayer)throw"nothing to backpropagate!";c=[];for(var b=0;b<this.outData.length;b++)this.costs[b]=this.nextLayer.costs[b]}}inSize(){return this.inData.length}outSize(){return this.outData.length}}swag.IdentityLayer=a,swag.Identity=a,swag.Input=a,swag.DummyLayer=a,swag.InputLayer=a,swag.OutputLayer=a,swag.Output=a}{class f{constructor(a,b,c,e,f,d=1){if(this.inWidth=a,this.inHeight=b,this.inDepth=c,this.filterWidth=e,this.filterHeight=f,this.stride=d,this.outData=new Float32Array(Math.ceil((a-e+1)/d)*Math.ceil((b-f+1)/d)*this.inDepth),this.inData=new Float32Array(a*b*c),this.costs=new Float32Array(a*b*c),this.maxIndexes=new Float32Array(this.outData.length),this.accessed=new Float32Array(this.costs.length).fill(1),this.filterWidth>a||this.filterHeight>b)throw"Max Pool layer error: Pooling size (width / height) cannot be bigger than the inputs corresponding (width/height)";this.hMFHPO=Math.ceil((this.inHeight-this.filterHeight+1)/this.stride),this.wMFWPO=Math.ceil((this.inWidth-this.filterWidth+1)/this.stride),this.hMFWMF=this.hMFHPO*this.wMFWPO,this.wIH=this.inWidth*this.inHeight}inSize(){return this.inData.length}outSize(){return this.outData.length}inSizeDimensions(){return[this.inWidth,this.inHeight,this.inDepth]}outSizeDimensions(){return[Math.ceil((this.inWidth-this.filterWidth+1)/this.stride),Math.ceil((this.inHeight-this.filterHeight+1)/this.stride),this.inDepth]}forward(a){if(a){if(a.length!=this.inSize())throw"INPUT SIZE WRONG ON MAX POOL LAYER:\nexpected array size ("+this.inSize()+", dimensions: ["+this.inSizeDimensions()+"]), got: ("+a.length+")";for(var c=0;c<a.length;c++)this.inData[c]=a[c]}this.outData.fill(0);for(var d=0;d<this.hMFHPO;d++){let j=d*this.stride,m=d*this.wMFWPO;for(var e=0;e<this.wMFWPO;e++){let n=e*this.stride;for(var f=0;f<this.inDepth;f++){let k=e+m+f*this.hMFWMF,l=f*this.wIH+n,g=this.inData[j*this.inWidth+l];for(var h=0;h<this.filterHeight;h++){let i=(h+j)*this.inWidth+l;for(var b=1;b<this.filterWidth;b++)this.inData[b+i]>g&&(g=this.inData[b+i],this.maxIndexes[k]=b+i)}this.outData[k]=g}}}}backward(c){if(this.costs.fill(0),!c&& void 0==this.nextLayer)throw"error backproping on an unconnected layer with no expected parameter input";for(var d=0;d<this.hMFHPO;d++){this.stride;let g=d*this.wMFWPO;for(var e=0;e<this.wMFWPO;e++){this.stride;for(var f=0;f<this.inDepth;f++){let b=e+g+f*this.hMFWMF,h=c?c[b]-this.outData[b]:this.nextLayer.costs[b];this.costs[this.maxIndexes[b]]+=h,this.accessed[this.maxIndexes[b]]++}}}for(var a=0;a<this.inSize();a++)this.costs[a]=this.costs[a]/this.accessed[a],this.accessed[a]=1}}swag.MaxPoolLayer=f,swag.MaxPool=f}{class b{sigmoid(a){return 1/(1+Math.exp(-a))}sigmoidPrime(a){return Math.exp(-a)/Math.pow(1+Math.exp(-a),2)}constructor(a){this.nextLayer,this.inData=new Float32Array(a),this.outData=new Float32Array(a),this.costs=new Float32Array(a)}forward(a){if(a){if(a.length!=this.inData.length)throw"INPUT SIZE WRONG ON SIG LAYER:\nexpected size ("+this.inSize+"), got: ("+a.length+")";for(var b=0;b<a.length;b++)this.inData[b]=a[b]}for(var c=0;c<this.outSize();c++)this.outData[c]=this.sigmoid(this.inData[c])}backward(b){if(!b){if(void 0==this.nextLayer)throw"nothing to backpropagate!";b=[];for(var c=0;c<this.outData.length;c++)b.push(this.nextLayer.costs[c]+this.nextLayer.inData[c])}for(var a=0;a<this.outSize();a++){let d=b[a]-this.outData[a];this.costs[a]=d*this.sigmoidPrime(this.inData[a])}}inSize(){return this.inData.length}outSize(){return this.outData.length}}swag.SigmoidLayer=b,swag.Sigmoid=b,swag.Sig=b}{class c{sine(a){return Math.sin(a)}sinePrime(a){return Math.cos(a)}constructor(a){this.nextLayer,this.inData=new Float32Array(a),this.outData=new Float32Array(a),this.costs=new Float32Array(a)}forward(a){if(a){if(a.length!=this.inData.length)throw"INPUT SIZE WRONG ON Sine LAYER:\nexpected size ("+this.inSize+"), got: ("+a.length+")";for(var b=0;b<a.length;b++)this.inData[b]=a[b]}for(var c=0;c<this.outSize();c++)this.outData[c]=this.sine(this.inData[c])}backward(b){if(!b){if(void 0==this.nextLayer)throw"nothing to backpropagate!";b=[];for(var c=0;c<this.outData.length;c++)b.push(this.nextLayer.costs[c]+this.nextLayer.inData[c])}for(var a=0;a<this.outSize();a++){let d=b[a]-this.outData[a];this.costs[a]=d*this.sinePrime(this.inData[a])}}inSize(){return this.inData.length}outSize(){return this.outData.length}}swag.SineLayer=c,swag.Sine=c,swag.Sin=c}{class g{tanh(a){return Math.tanh(a)}tanhPrime(a){return 1-Math.pow(Math.tanh(a),2)}constructor(a){this.nextLayer,this.inData=new Float32Array(a),this.outData=new Float32Array(a),this.costs=new Float32Array(a)}forward(a){if(a){if(a.length!=this.inData.length)throw"INPUT SIZE WRONG ON Tanh LAYER:\nexpected size ("+this.inSize+"), got: ("+a.length+")";for(var b=0;b<a.length;b++)this.inData[b]=a[b]}for(var c=0;c<this.outSize();c++)this.outData[c]=this.tanh(this.inData[c])}backward(b){if(!b){if(void 0==this.nextLayer)throw"nothing to backpropagate!";b=[];for(var c=0;c<this.outData.length;c++)b.push(this.nextLayer.costs[c]+this.nextLayer.inData[c])}for(var a=0;a<this.outSize();a++){let d=b[a]-this.outData[a];this.costs[a]=d*(1-Math.pow(this.outData[a],2))}}inSize(){return this.inData.length}outSize(){return this.outData.length}}swag.TanhLayer=g,swag.Tanh=g}